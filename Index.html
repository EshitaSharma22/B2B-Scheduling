import React, { useEffect, useState } from "react";
import { initializeApp } from "firebase/app";
import { getFirestore, collection, getDocs, doc, setDoc } from "firebase/firestore";

const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_AUTH_DOMAIN",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_STORAGE_BUCKET",
  messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
  appId: "YOUR_APP_ID"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const B2BScheduling = () => {
  const [schedule, setSchedule] = useState([]);
  const [formData, setFormData] = useState({
    name: "",
    designation: "",
    organisation: "",
    email: "",
    phone: "",
    sector: ""
  });

  useEffect(() => {
    fetchData();
  }, []);

  const fetchData = async () => {
    const querySnapshot = await getDocs(collection(db, "schedules"));
    const data = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
    setSchedule(data);
  };

  const bookSlot = async (id) => {
    if (Object.values(formData).some(value => !value)) {
      alert("Please fill in all the required fields.");
      return;
    }

    await setDoc(doc(db, "schedules", id), formData, { merge: true });
    fetchData();
  };

  const handleChange = (e) => {
    setFormData({ ...formData, [e.target.name]: e.target.value });
  };

  return (
    <div style={{ padding: "20px", fontFamily: "Arial, sans-serif" }}>
      <h1>B2B Scheduling</h1>
      <form>
        <input type="text" name="name" placeholder="Full Name" onChange={handleChange} required />
        <input type="text" name="designation" placeholder="Designation" onChange={handleChange} required />
        <input type="text" name="organisation" placeholder="Organisation" onChange={handleChange} required />
        <input type="email" name="email" placeholder="Email" onChange={handleChange} required />
        <input type="tel" name="phone" placeholder="Phone Number" onChange={handleChange} required />
        <select name="sector" onChange={handleChange} required>
          <option value="">Select Sector</option>
          <option value="Finance">Finance</option>
          <option value="Healthcare">Healthcare</option>
          <option value="Technology">Technology</option>
          <option value="Education">Education</option>
        </select>
      </form>
      <table style={{ width: "100%", borderCollapse: "collapse", marginTop: "20px" }}>
        <thead>
          <tr>
            <th>Time</th>
            <th>Priority</th>
            <th>Booked By</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          {schedule.map(slot => (
            <tr key={slot.id}>
              <td>{slot.time || "N/A"}</td>
              <td>{slot.priority || "N/A"}</td>
              <td>{slot.name || "Available"}</td>
              <td>
                {!slot.name ? <button onClick={() => bookSlot(slot.id)}>Book</button> : "N/A"}
              </td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  );
};

export default B2BScheduling;
